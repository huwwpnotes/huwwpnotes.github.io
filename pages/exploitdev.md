---
layout: page
title: Exploit Dev
permalink: /exploitdev/
---

# Index

# Permissions

## Service Permissions

```
accesschk.exe -uwcqv "Group Name" *
e.g.
accesschk.exe -uwcqv "Users" *
accesschk.exe -uwcqv "Authenticated Users" *
accesschk.exe -uwcqv "Everyone" *
```

## Service Binary Permissions

```
Get-ChildItem C:\temp\ -Recurse | Get-Acl | grep "Everyone"
```

## Files and Registry Keys Read/Written

Use Procmon and icacls/accesschk.exe to 

# IPC

## COM

Find all COM objects registered with Windows
```
gwmi Win32_COMSetting | ? {$_.progid } | sort | ft ProgId,Caption,InprocServer32
```
Find methods of a specific COM object
```
$o = [activator]::CreateInstance([type]::GetTypeFromProgID(("WScript.Shell.1"))) | gm
```
Can then invoke a returned method if desired
```
$o.RegRead("HKEY_CURRENT_USER\Volatile Environment\LOGONSERVER")
```

### COM Hijacking
Sometimes COM objects invoke DLLs that can be hijacked for persistence/privesc. Basically use Sysmon to identify 

See https://pentestlab.blog/2020/05/20/persistence-com-hijacking/

```
InprocServer/InprocServer32
LocalServer/LocalServer32
TreatAs/ProgID
```
## Named Pipes

Process Explorer/Process Hacker can show handles to named pipes.
IONINJA can intercept read/writes from named pipes.
Accesschk.exe to check permissions on named pipes.

Can use ida and looked for the below imported functions
```
CreateNamePipe
ConnectNamedPipe
```

## RPC

RPC is available over UDP over Named Pipes.
When RPC over Named Pipes is used as the RPC protocol sequence, the pipe name that MUST be used is \PIPE\MSGSVC. 

You can use rpcivew to enumerate an reverse engineer the RPC methods on a process.

## Sockets

## Mailslots

## DDE

## DataCopy

A Windows Message to send data from one process to another.

## File Mapping

# Shared Memory

## Sections

Can use Process Hacker to see what sections a process has handles to.
Can use WinObj to see all sections on a machine.

## Reverse Engineering Tips

[API Monitor](http://www.rohitab.com/apimonitor) to monitor function calls
